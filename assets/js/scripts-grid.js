var teams = 
{
	"ANA": 
	{
		"NAME": "Anaheim",
		"SELECT": 1,
		"CURRENT": 107,
		"GAMES_LEFT": 1,
		"ROW": 42,
		"CONFERENCE": "W",
		"DIVISION": "P"
	},
	"ARI": 
	{
		"NAME": "Arizona",
		"SELECT": 1,
		"CURRENT": 56,
		"GAMES_LEFT": 2,
		"ROW": 19,
		"CONFERENCE": "W",
		"DIVISION": "P"
	},
	"BOS":
	{
		"NAME": "Boston",
		"SELECT": 1,
		"CURRENT": 95,
		"GAMES_LEFT": 2,
		"ROW": 37,
		"CONFERENCE": "E",
		"DIVISION": "A"		
	},
	"BUF": 
	{
		"NAME": "Buffalo",
		"SELECT": 1,
		"CURRENT": 54,
		"GAMES_LEFT": 2,
		"ROW": 15,
		"CONFERENCE": "E",
		"DIVISION": "A"	
	},
	"CAR": 
	{
		"NAME": "Carolina",
		"SELECT": 1,
		"CURRENT": 69,
		"GAMES_LEFT": 2,
		"ROW": 24,
		"CONFERENCE": "E",
		"DIVISION": "M"			
	},
	"CGY": 
	{
		"NAME": "Calgary",
		"SELECT": 1,
		"CURRENT": 95,
		"GAMES_LEFT": 2,
		"ROW": 40,
		"CONFERENCE": "W",
		"DIVISION": "P"
	},
	"CHI": 
	{
		"NAME": "Chicago",
		"SELECT": 1,
		"CURRENT": 102,
		"GAMES_LEFT": 2,
		"ROW": 39,
		"CONFERENCE": "W",
		"DIVISION": "C"
	},
	"CBJ": 
	{
		"NAME": "Columbus",
		"SELECT": 1,
		"CURRENT": 85,
		"GAMES_LEFT": 2,
		"ROW": 32,
		"CONFERENCE": "E",
		"DIVISION": "M"	
	},
	"COL": 
	{
		"NAME": "Colorado",
		"SELECT": 1,
		"CURRENT": 86,
		"GAMES_LEFT": 2,
		"ROW": 28,
		"CONFERENCE": "W",
		"DIVISION": "C"
	},
	"DAL": 
	{
		"NAME": "Dallas",
		"SELECT": 1,
		"CURRENT": 90,
		"GAMES_LEFT": 1,
		"ROW": 36,
		"CONFERENCE": "W",
		"DIVISION": "C"
	},
	"DET": 
	{
		"NAME": "Detroit",
		"SELECT": 1,
		"CURRENT": 97,
		"GAMES_LEFT": 2,
		"ROW": 38,
		"CONFERENCE": "E",
		"DIVISION": "A"	
	},
	"EDM": 
	{
		"NAME": "Edmonton",
		"SELECT": 1,
		"CURRENT": 61,
		"GAMES_LEFT": 2,
		"ROW": 19,
		"CONFERENCE": "W",
		"DIVISION": "P"
	},
	"FLA": 
	{
		"NAME": "Florida",
		"SELECT": 1,
		"CURRENT": 87,
		"GAMES_LEFT": 2,
		"ROW": 28,
		"CONFERENCE": "E",
		"DIVISION": "A"	
	},
	"LAK": 
	{
		"NAME": "Los Angeles",
		"SELECT": 1,
		"CURRENT": 93,
		"GAMES_LEFT": 2,
		"ROW": 37,
		"CONFERENCE": "W",
		"DIVISION": "P"
	},
	"MIN": 
	{
		"NAME": "Minnesota",
		"SELECT": 1,
		"CURRENT": 98,
		"GAMES_LEFT": 2,
		"ROW": 41,
		"CONFERENCE": "W",
		"DIVISION": "C"
	},
	"MTL": 
	{
		"NAME": "Montreal",
		"SELECT": 1,
		"CURRENT": 106,
		"GAMES_LEFT": 2,
		"ROW": 42,
		"CONFERENCE": "E",
		"DIVISION": "A"	
	},
	"NJD": 
	{
		"NAME": "New Jersey",
		"SELECT": 1,
		"CURRENT": 77,
		"GAMES_LEFT": 2,
		"ROW": 27,
		"CONFERENCE": "E",
		"DIVISION": "M"	
	},
	"NSH": 
	{
		"NAME": "Nashville",
		"SELECT": 1,
		"CURRENT": 104,
		"GAMES_LEFT": 2,
		"ROW": 41,
		"CONFERENCE": "W",
		"DIVISION": "C"
	},
	"NYI": 
	{
		"NAME": "NY Islanders",
		"SELECT": 1,
		"CURRENT": 98,
		"GAMES_LEFT": 2,
		"ROW": 39,
		"CONFERENCE": "E",
		"DIVISION": "M"	
	},
	"NYR": 
	{
		"NAME": "NY Rangers",
		"SELECT": 1,
		"CURRENT": 111,
		"GAMES_LEFT": 2,
		"ROW": 48,
		"CONFERENCE": "E",
		"DIVISION": "M"	
	},
	"OTT": 
	{
		"NAME": "Ottawa",
		"SELECT": 1,
		"CURRENT": 95,
		"GAMES_LEFT": 2,
		"ROW": 35,
		"CONFERENCE": "E",
		"DIVISION": "A"	
	},
	"PHI": 
	{
		"NAME": "Philadelphia",
		"SELECT": 1,
		"CURRENT": 84,
		"GAMES_LEFT": 2,
		"ROW": 30,
		"CONFERENCE": "E",
		"DIVISION": "M"	
	},
	"PIT": 
	{
		"NAME": "Pittsburgh",
		"SELECT": 1,
		"CURRENT": 96,
		"GAMES_LEFT": 2,
		"ROW": 38,
		"CONFERENCE": "E",
		"DIVISION": "M"	
	},
	"SJS": 
	{
		"NAME": "San Jose",
		"SELECT": 1,
		"CURRENT": 87,
		"GAMES_LEFT": 2,
		"ROW": 35,
		"CONFERENCE": "W",
		"DIVISION": "P"
	},
	"STL": 
	{
		"NAME": "St. Louis",
		"SELECT": 1,
		"CURRENT": 105,
		"GAMES_LEFT": 2,
		"ROW": 40,
		"CONFERENCE": "W",
		"DIVISION": "C"
	},
	"TBL": 
	{
		"NAME": "Tampa Bay",
		"SELECT": 1,
		"CURRENT": 104,
		"GAMES_LEFT": 2,
		"ROW": 46,
		"CONFERENCE": "E",
		"DIVISION": "A"	
	},
	"TOR": 
	{
		"NAME": "Toronto",
		"SELECT": 1,
		"CURRENT": 67,
		"GAMES_LEFT": 1,
		"ROW": 25,
		"CONFERENCE": "E",
		"DIVISION": "A"	
	},
	"VAN": 
	{
		"NAME": "Vancouver",
		"SELECT": 1,
		"CURRENT": 97,
		"GAMES_LEFT": 2,
		"ROW": 40,
		"CONFERENCE": "W",
		"DIVISION": "P"
	},
	"WPG": 
	{
		"NAME": "Winnipeg",
		"SELECT": 1,
		"CURRENT": 96,
		"GAMES_LEFT": 2,
		"ROW": 35,
		"CONFERENCE": "W",
		"DIVISION": "C"
	},
	"WSH": 
	{
		"NAME": "Washington",
		"SELECT": 1,
		"CURRENT": 101,
		"GAMES_LEFT": 1,
		"ROW": 40,
		"CONFERENCE": "E",
		"DIVISION": "M"	
	}
};

var gamesLeft = 
{														
	"7":{
		"HOME": "VAN",
		"AWAY": "ARI",
		"DATE": 1428537600000
	},
	"25":{
		"HOME": "EDM",
		"AWAY": "SJS",
		"DATE": 1428537600000
	},			
	"15":{
		"HOME": "CBJ",
		"AWAY": "BUF",
		"DATE": 1428624000000
	},
	"8":{
		"HOME": "ANA",
		"AWAY": "ARI",
		"DATE": 1428710400000
	},
	"16":{
		"HOME": "BUF",
		"AWAY": "PIT",
		"DATE": 1428710400000
	},
	"26":{
		"HOME": "VAN",
		"AWAY": "EDM",
		"DATE": 1428710400000
	},
	"27":{
		"HOME": "TOR",
		"AWAY": "MTL",
		"DATE": 1428710400000
	},
	"126":{
	"HOME": "OTT",
	"AWAY": "NYR",
	"DATE": 1428537600000
	},
	"127":{
	"HOME": "CAR",
	"AWAY": "PHI",
	"DATE": 1428537600000
	},
	"128":{
	"HOME": "BOS",
	"AWAY": "FLA",
	"DATE": 1428537600000
	},
	"129":{
	"HOME": "DET",
	"AWAY": "MTL",
	"DATE": 1428537600000
	},
	"130":{
	"HOME": "NJD",
	"AWAY": "TBL",
	"DATE": 1428537600000
	},
	"131":{
	"HOME": "CHI",
	"AWAY": "STL",
	"DATE": 1428537600000
	},
	"132":{
	"HOME": "MIN",
	"AWAY": "NSH",
	"DATE": 1428537600000
	},
	"133":{
	"HOME": "WPG",
	"AWAY": "COL",
	"DATE": 1428537600000
	},
	"134":{
	"HOME": "LAK",
	"AWAY": "CGY",
	"DATE": 1428537600000
	},
	"135":{
	"HOME": "NYI",
	"AWAY": "PIT",
	"DATE": 1428624000000
	},
	"136":{
	"HOME": "OTT",
	"AWAY": "PHI",
	"DATE": 1428710400000
	},
	"137":{
	"HOME": "NYR",
	"AWAY": "WSH",
	"DATE": 1428710400000
	},
	"138":{
	"HOME": "CGY",
	"AWAY": "WPG",
	"DATE": 1428710400000
	},
	"139":{
	"HOME": "SJS",
	"AWAY": "LAK",
	"DATE": 1428710400000
	},
	"140":{
	"HOME": "DET",
	"AWAY": "CAR",
	"DATE": 1428710400000
	},
	"141":{
	"HOME": "NJD",
	"AWAY": "FLA",
	"DATE": 1428710400000
	},
	"142":{
	"HOME": "CBJ",
	"AWAY": "NYI",
	"DATE": 1428710400000
	},
	"143":{
	"HOME": "BOS",
	"AWAY": "TBL",
	"DATE": 1428710400000
	},
	"144":{
	"HOME": "MIN",
	"AWAY": "STL",
	"DATE": 1428710400000
	},
	"145":{
	"HOME": "NSH",
	"AWAY": "DAL",
	"DATE": 1428710400000
	},
	"146":{
	"HOME": "CHI",
	"AWAY": "COL",
	"DATE": 1428710400000
	}
};
var divisions = {"M": "Metropolitan", "A": "Atlantic", "P": "Pacific", "C": "Central"};
var conferences = {"E": "Eastern", "W": "Western"};


var preDefinedTeams = 
{
	"tankTeams": ["ARI", "BUF"],
	"easternPlayoff": ["BOS", "DET","PIT", "NYI", "OTT"],
	"westernPlayoff": ["LAK", "CGY", "WPG"],
	"westernSeeding": ["CHI", "STL", "NSH"]
};

$(document).ready(function(){

	//DISPLAY TEAMS
	var teamAllTemplate = "<tr><td><input type='checkbox' id='{{Abbrv}}-View' class='standings-view'></td><td><img height='20' width='20' src='assets/img/{{Abbrv}}.png'></img></td><td>{{Name}}</td>" 
						+"<td>{{Conference}}</td><td>{{Division}}</td>"
						+"<td>{{Points}}</td>"+
						"<td>{{ROW}}</td>" +
						+"</tr>";
	var teamSelectedTemplate = "<tr id='{{Abbrv}}-SelRow' class='selected-row'></td><td><img height='20' width='20' src='assets/img/{{Abbrv}}.png'></img></td><td>{{Name}}</td>" 
						+"<td>{{Conference}}</td><td>{{Division}}</td>"
						+ "<td id='{{Abbrv}}-Sim'>{{Points}}</td>"
						+ "<td id='{{Abbrv}}-ROW'>{{ROW}}</td>"
						+ "<td id='{{Abbrv}}-GL'>{{GamesLeft}}</td>"
						+ "<td id='{{Abbrv}}-Status'><strong>W</strong>: 0 | <strong>OTL</strong>: 0 | <strong>L</strong>: 0</td>"
						+"</tr>";

	for (var team in teams) {
		teams[team]["CALC_GAMES_LEFT"] = teams[team]["GAMES_LEFT"];
		var teamData = {"Abbrv": team, 
		  	"Name": teams[team]["NAME"], 
		  	"Points": teams[team]["CURRENT"], 
		  	"GamesLeft": teams[team]["CALC_GAMES_LEFT"], 
		  	"ROW": teams[team]["ROW"],
		  	"Conference": conferences[teams[team]["CONFERENCE"]],
		  	"Division": divisions[teams[team]["DIVISION"]]}
		var allHtml = Mustache.to_html(teamAllTemplate, teamData);
		$(allHtml).appendTo("#tankTeams");
		var selectedHTML = Mustache.to_html(teamSelectedTemplate, teamData);
		$(selectedHTML).appendTo("#selectedTeamsBody");
		teams[team]["SELECT"] = 0;
		teams[team]["W"] = 0;
		teams[team]["L"] = 0;
		teams[team]["OTL"] = 0;
	}

	$(".selected-row").each(function(i, obj){
		$(obj).hide();
	});

	// start team table hidden
	$("#teamTable").toggle();

	function getSelectedTeams(){
		var selectedTeams = []
		for (var team in teams) {
			if (teams[team]["SELECT"] === 1){
			  selectedTeams.push(team);
			}
		}
		return selectedTeams;
	}

	// Get date array of upcoming games
	var firstDate = 1428537600000;
	var lastDate = 1428710400000;
	var dayMillisec = 1000 * 60 * 60 * 24; // days in milliseconds

	var gameHtml = "";
	var gameHeaderHtml = "<tr><th>Date</th>";

	for (var team in teams){
		gameHeaderHtml += "<th id='" + team +"-Header' class ='" + team +" TeamCol'>" + team + "</th>";
	}
	$(gameHeaderHtml).appendTo("#gameHeader");


	// outer loop for rows = dates
	for (var date = firstDate; date <= lastDate; date = date + dayMillisec){
		//  inner loop for columns = teams

		var gameDate = new Date(parseInt(date));
		gameDate.setDate(gameDate.getDate() + 1); //add 1 to date as js starts at 0.
		var dateStr = gameDate.getFullYear();
		var dd = gameDate.getDate();
		var mm = gameDate.getMonth() + 1;
		var y = gameDate.getFullYear();
		var formattedDate = mm + '/'+ dd + '/'+ y;
		gameHtml += "<tr><td>" + formattedDate + "</td>";
		for (var team in teams){
			// column per team
			gameHtml += "<td id='" + team + "-" + date + "' class ='" + team +" TeamCol'></td>";

		}
		gameHtml += "</tr>";
	}
	$(gameHtml).appendTo("#gameData");

	var homeGameTemplate = "<table id='{{GameID}}-Table-{{Home}}' class='GameTable'>"
		+ "<td>{{IntroStr}}</td>"
		+"<td>" // winner radios
		+ "<input type='radio' name='{{GameID}}-Winner-{{Home}}' id='{{GameID}}-WIN-{{Home}}-{{Away}}' class='game-result' value='{{Home}}'>W<br>"
		+ "<input type='radio' name='{{GameID}}-Winner-{{Home}}' id='{{GameID}}-LOSE-{{Home}}-{{Away}}' class='game-result' value='{{Away}}'>L<br>"
		+ "</td>"
		+ "<td>" // ot radios
		+ "<input type='radio' name='{{GameID}}-OT-{{Home}}' id='{{GameID}}-OT-N-{{Home}}-{{Away}}' class='game-ot' value='{{GameID}}-OT-N-{{Home}}' checked>None<br>" 
		+ "<input type='radio' name='{{GameID}}-OT-{{Home}}' id='{{GameID}}-OT-O-{{Home}}-{{Away}}' class='game-ot' value='{{GameID}}-OT-O-{{Home}}'>OT<br>"
		+ "<input type='radio' name='{{GameID}}-OT-{{Home}}' id='{{GameID}}-OT-S-{{Home}}-{{Away}}' class='game-ot' value='{{GameID}}-OT-S-{{Home}}'>SO  "
		+ "</td>"
		+ "</table>";


	var awayGameTemplate = "<table id='{{GameID}}-Table-{{Away}}' class='GameTable'>"
		+ "<td>{{IntroStr}}</td>"
		+"<td>" // winner radios
		+ "<input type='radio' name='{{GameID}}-Winner-{{Away}}' id='{{GameID}}-WIN-{{Away}}-{{Home}}' class='game-result' value='{{Away}}'>W<br>"
		+ "<input type='radio' name='{{GameID}}-Winner-{{Away}}' id='{{GameID}}-LOSE-{{Away}}-{{Home}}' class='game-result' value='{{Home}}'>L<br>"
		+ "</td>"
		+ "<td>" // ot radios
		+ "<input type='radio' name='{{GameID}}-OT-{{Away}}' id='{{GameID}}-OT-N-{{Away}}-{{Home}}' class='game-ot' value='{{GameID}}-OT-N-{{Away}}' checked>None<br>" 
		+ "<input type='radio' name='{{GameID}}-OT-{{Away}}' id='{{GameID}}-OT-O-{{Away}}-{{Home}}' class='game-ot' value='{{GameID}}-OT-O-{{Away}}'>OT<br>"
		+ "<input type='radio' name='{{GameID}}-OT-{{Away}}' id='{{GameID}}-OT-S-{{Away}}-{{Home}}' class='game-ot' value='{{GameID}}-OT-S-{{Away}}'>SO"
		+ "</td>"
		+ "</table>";

	// inject gameinfo where appropriate
	for (var game in gamesLeft){
		var homeIdStr = gamesLeft[game]["HOME"] + "-" + gamesLeft[game]["DATE"];
		var awayIdStr = gamesLeft[game]["AWAY"] + "-" + gamesLeft[game]["DATE"];
		var homeHtml = "vs " + gamesLeft[game]["AWAY"];
		var awayHtml = "@ " + gamesLeft[game]["HOME"];
		// homeHtml = "";
		// awayHtml = "";


		var homeGameData = {
				// "Date": gameDate,
				"Away": gamesLeft[game]["AWAY"],
				"Home": gamesLeft[game]["HOME"],
				"GameID": game,
				"IntroStr": homeHtml
				};
		var awayGameData ={
				// "Date": gameDate,
				"Away": gamesLeft[game]["AWAY"],
				"Home": gamesLeft[game]["HOME"],
				"GameID": game,
				"IntroStr": awayHtml
			}
		var homeInHtml = Mustache.to_html(homeGameTemplate, homeGameData);
		var awayInHtml = Mustache.to_html(awayGameTemplate, awayGameData);
		$("#" + homeIdStr).html(homeInHtml);
		$("#" + awayIdStr).html(awayInHtml);
	}



	// GENERATE GAMES


	// // Add games and write via template
	// for (var game in gamesLeft){
	// 	var gameDate = new Date(parseInt(gamesLeft[game]["DATE"]));
	// 	gameDate.setDate(gameDate.getDate() + 1); //add 1 to date
	// 	var dateStr = gameDate.getFullYear();
	// 	var dd = gameDate.getDate();
	// 	var mm = gameDate.getMonth() + 1;
	// 	var y = gameDate.getFullYear();

	// 	var formattedDate = mm + '/'+ dd + '/'+ y;
	// 	var gameData = {
	// 				"Date": formattedDate, 
	// 				// "Date": gameDate,
	// 				"Away": gamesLeft[game]["AWAY"],
	// 				"Home": gamesLeft[game]["HOME"],
	// 				"GameID": game,
	// 				"Month": mm,
	// 				"Day": dd
	// 				};
	// 	var html = Mustache.to_html(gameTemplate, gameData);
	// 	$(html).appendTo("#gameData");
	// 	gamesLeft[game]["OT"] = "N";
	// 	// if team is one of the selected auto-check. first, check away. do this to avoid duplicate attempts at selecting.
	// 	// if (isSelectedTeam(gamesLeft[game]["AWAY"])){
	// 	// 	$("#" + game + "-" + gamesLeft[game]["HOME"]).prop("checked", true);
	// 	// 	gamesLeft[game]["WIN"] = gamesLeft[game]["HOME"];
	// 	// 	$("#" + game + "-WinPic").html("<img height='20' width='20' src='assets/img/" + gamesLeft[game]["HOME"] + ".png'></img>");
	// 	// }
	// 	// // if not, selected team is the home team. check that one.
	// 	// else{
	// 	// 	$("#" + game + "-" + gamesLeft[game]["AWAY"]).prop("checked", true);
	// 	// 	gamesLeft[game]["WIN"] = gamesLeft[game]["AWAY"];
	// 	// 	$("#" + game + "-WinPic").html("<img height='20' width='20' src='assets/img/" + gamesLeft[game]["AWAY"] + ".png'></img>");
	// 	// }
	// }

	$(".TeamCol").each(function(i, obj){
		$(obj).hide();
	});


	updatePoints();

	function isSelectedTeam(team) {
	  return getSelectedTeams().indexOf(team) > -1;
	}

	$(".game-result").change(function(){
		var idArr = this.id.split("-");
		var gameID = idArr[0];
		var typeID = idArr[1];
		var teamID = idArr[2];
		var oppID = idArr[3];
		if (typeID == "WIN"){
			gamesLeft[gameID]["WIN"] = teamID;
			// set loss in corresponding grid
			$("#" + gameID + "-LOSE-" + oppID + "-" + teamID).prop("checked", true);
		}
		else{
			gamesLeft[gameID]["WIN"] = oppID;
			$("#" + gameID + "-WIN-" + oppID + "-" + teamID).prop("checked", true);
		}

		updatePoints();
	});

	// When OT is placed in, update point totals
	$(".game-ot").change(function(){
		//  Update gamesLeft object
		var idArr = this.id.split("-");
		var gameID = idArr[0];
		var otType = idArr[2];
		var teamID = idArr[3];
		var oppID = idArr[4];
		gamesLeft[gameID]["OT"] = otType;
		//update ui for game in opp. team
		$("#" + gameID + "-OT-" + otType + "-" + oppID + "-" + teamID).prop("checked", true);	

		updatePoints();
	});

	$("#prePopulateTeams").change(function(){
		// first, unselect currently selected
		for (var team in teams){
			teams[team]["SELECT"] = 0;
			$("#" + team + "-View").prop("checked", false);
		}

		// clear selected teams grid
		$(".selected-row").each(function(i, obj){
			$(obj).hide();
		});

		var teamType = $("#prePopulateTeams").val();
		if (teamType !== ""){
			for(var i=0; i < preDefinedTeams[teamType].length; i++){
				teams[preDefinedTeams[teamType][i]]["SELECT"] = 1;
				$("#" + preDefinedTeams[teamType][i] + "-View").prop("checked", true);
				updateSelectedGrid(preDefinedTeams[teamType][i]);

			}
			updateGameGrid();
		}

	});

	// When select team, update grid of games and SELECT state of team.
	$(".standings-view").change(function(){
		//  Update gamesLeft object
		var teamID = this.id.split("-")[0];
		if ($(this).is(":checked")){
			teams[teamID]["SELECT"] = 1;
		}
		else{
			teams[teamID]["SELECT"] = 0;
		}
		updateGameGrid();
		updateSelectedGrid(teamID);
		
	});

	// Minimize ALL table when clicked
	$("#hideTable").click(function(){
		//  Hide table when clicked
		$("#teamTable").toggle();
		
	});

	// Update grid view based on selected teams.
	function updateGameGrid(){
		// hide teams not currently selected
		$(".TeamCol").each(function(i, obj){
			var teamID = obj.id.split("-")[0];

			if (isSelectedTeam(teamID)){
				$(obj).show();
			}
			else{
				$(obj).hide();
			}
		});

	}

	function updateSelectedGrid(team){
		$("#" + team + "-SelRow").toggle();
	}
	

	// There is a better way to do this, but life goes on.
	function updatePoints(){
		// reset all points to current
		for (var team in teams) {
			// if (teams[team]["SELECT"] === 1){
				teams[team]["CALC"] = teams[team]["CURRENT"];
				teams[team]["CALC_ROW"] = teams[team]["ROW"];
				teams[team]["CALC_GAMES_LEFT"] = teams[team]["GAMES_LEFT"];
				teams[team]["W"] = 0;
				teams[team]["L"] = 0;
				teams[team]["OTL"] = 0;
			// }
			
		}

		// add up the points, dude
		for (var game in gamesLeft){
			var winningTeam = gamesLeft[game]["WIN"];
			var homeTeam = gamesLeft[game]["HOME"];
			var awayTeam = gamesLeft[game]["AWAY"];
			if (winningTeam !== undefined && winningTeam != ""){
				// if we are calculating points for the winner, then add
				if (teams[winningTeam]["SELECT"] === 1){
					teams[winningTeam]["CALC_GAMES_LEFT"] = teams[winningTeam]["CALC_GAMES_LEFT"] - 1;
					// get the winning team, first. add 2 points.
					teams[winningTeam]["CALC"] = teams[winningTeam]["CALC"] + 2;
					teams[winningTeam]["W"] = teams[winningTeam]["W"] + 1;
					// only add to ROW if not a shoot-out
					if (gamesLeft[game]["OT"] !== "S"){
						teams[winningTeam]["CALC_ROW"] = teams[winningTeam]["CALC_ROW"] + 1;
					}
				}
				// get loser team -- they are the team that did not win.
				if (homeTeam === winningTeam){
					var losingTeam = awayTeam;
				}
				else{
					var losingTeam = homeTeam;
				}
				teams[losingTeam]["CALC_GAMES_LEFT"] = teams[losingTeam]["CALC_GAMES_LEFT"] - 1;
				// if game went to OT, give out loser point.
				if (gamesLeft[game]["OT"] === "O" || gamesLeft[game]["OT"] === "S"){
					// Give losing team a OTL point.
					teams[losingTeam]["CALC"] = teams[losingTeam]["CALC"] + 1;
					teams[losingTeam]["OTL"] = teams[losingTeam]["OTL"] + 1;
				}
				// otherwise, the team just lost.
				else{
					teams[losingTeam]["L"] = teams[losingTeam]["L"] + 1;
				}
				
			}
		}

		// Update grid
		for (var team in teams) {
			if (teams[team]["SELECT"] === 1){
				$("#" + team + "-Sim").text(teams[team]["CALC"]); // set simulated points
				$("#" + team + "-ROW").text(teams[team]["CALC_ROW"]); // set simulated ROW
				var statusText = "<strong>W</strong>: " + teams[team]["W"] +
									" | <strong>OTL</strong>: " + teams[team]["OTL"] +
									" | <strong>L</strong>: " + teams[team]["L"];
				$("#" + team + "-Status").html(statusText)
				$("#" + team + "-GL").text(teams[team]["CALC_GAMES_LEFT"]);
			}
			
		}

	}
	$("#teamTable").DataTable({"order": [[5, "desc"], [6, "desc"]], paging: false, bInfo: false, autoWidth: false});
	// $("#gamesTable").DataTable({"order": [[6, "asc"], [7, "asc"]], paging: false, bInfo: false, columnDefs: [{targets: [6, 7], visible: false}]});
})
